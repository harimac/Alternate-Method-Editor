<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript">
        var topWnd = window.parent.parent;
        var aras = topWnd.aras;
    </script>
    <script type="text/javascript" src="../../vendors/monaco-editor/min/vs/loader.js"></script>
    <style type="text/css">
        html, body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0px;
            padding: 0px;
        }

        li {
            list-style-type: none !important;
        }
    </style>
    <link rel="stylesheet" href="css/methodeditor.css" />
    <script type="text/javascript">
        window.addEventListener('load', function() {

            // initialize toolbar, helpTab, editor
            initDiffEditor();
        });

        // Initialize the diff editor
        function initDiffEditor() {
            require.config({ paths: { 'vs': '../../vendors/monaco-editor/min/vs' }});
            require(['vs/editor/editor.main'], function() {
                // [XAM]-S Restore theme
                var editorTheme = 'vs'; // set the default method theme
                // Get the Editor theme from the user preference if possible
                var userPrefAml = '<Item type="Core_GlobalLayout" action="get" select="monaco_editor_theme">' +
                                    '<source_id>' +
                                        '<Item type="Preference" action="get" select="id">' +
                                            '<identity_id>' +
                                                '<Item type="Identity" action="get" select="id">' +
                                                    '<is_alias>1</is_alias>' +
                                                    '<id>' + aras.getIdentityList() + '</id>' +
                                                '</Item>' +
                                            '</identity_id>' +
                                        '</Item>' +
                                    '</source_id>' +
                                  '</Item>';

                var res = aras.soapSend('ApplyItem', userPrefAml);
                if (res.getFaultCode() != 0) 
                {
                    aras.AlertError(res);
                    return;
                }
                var globalPref = res.getResult().selectSingleNode('./Item');
                var editorTheme = aras.getItemProperty(globalPref, 'monaco_editor_theme') || editorTheme;
                // [XAM]-E Restore theme

                var oldMethodCode = parent.methodEditorHelper.getComparisonMethodCode();
                var currentMethodCode = aras.getItemProperty(parent.parent.document.item, "method_code") || "";

                var codeLang = aras.getItemProperty(parent.parent.document.item, "method_type");
                var editorLang = "javascript";
                switch(codeLang) {
                    case "VB":
                        editorLang = "vbscript";
                        break;
                    case "C#":
                        editorLang = "csharp";
                        break;
                    case "JavaScript":
                        editorLang = "javascript";
                        break;
                }

                var originalModel = monaco.editor.createModel(oldMethodCode, editorLang);
                var currentModel = monaco.editor.createModel(currentMethodCode, editorLang);

                var diffEditor = monaco.editor.createDiffEditor(document.getElementById("diffeditormain"));
                diffEditor.setModel({
                    original: originalModel,
                    modified: currentModel
                })
                diffEditor._modifiedEditor.getModel().updateOptions({ tabSize: 2, insertSpaces:false });
                diffEditor._originalEditor.getModel().updateOptions({ tabSize: 2, insertSpaces:false });
                parent.editor = diffEditor._modifiedEditor; // [XAM] Update to latest monaco
                parent.monacoEditor = monaco.editor;
                parent.methodEditorHelper.setLanguage(codeLang);
                parent.methodEditorHelper.setTheme(editorTheme); // [XAM] Restore theme
                parent.methodEditorHelper.setEditorChangeEvent();
                parent.methodEditorHelper.addEditorContextActions();
            });
        }
    </script>
</head>
<body>
    <div id="diffeditormain" style="height:100%; width:100%; overflow: hidden;"></div>
</body>
</html>
