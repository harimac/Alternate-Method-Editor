<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript">
        var topWnd = window.parent.parent;
        var aras = topWnd.aras;
    </script>
    <script type="text/javascript" src="../../vendors/monaco-editor/min/vs/loader.js"></script>
    <style type="text/css">
        html, body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0px;
            padding: 0px;
        }

        li {
            list-style-type: none !important;
        }
    </style>
    <link rel="stylesheet" href="css/methodeditor.css" />
    <script type="text/javascript">
        window.addEventListener('load', function() {

            // initialize toolbar, helpTab, editor
            initEditor();
        });

        // initialize the Monaco editor
        function initEditor() {
            require.config({ paths: { 'vs': '../../vendors/monaco-editor/min/vs' }});
            require(['vs/editor/editor.main'], function() {
                // [XAM]-S Restore theme
                var editorTheme = 'vs'; // set the default method theme
                // Get the Editor theme from the user preference if possible
                var userPrefAml = '<Item type="Core_GlobalLayout" action="get" select="monaco_editor_theme">' +
                                    '<source_id>' +
                                        '<Item type="Preference" action="get" select="id">' +
                                            '<identity_id>' +
                                                '<Item type="Identity" action="get" select="id">' +
                                                    '<is_alias>1</is_alias>' +
                                                    '<id>' + aras.getIdentityList() + '</id>' +
                                                '</Item>' +
                                            '</identity_id>' +
                                        '</Item>' +
                                    '</source_id>' +
                                  '</Item>';

                var res = aras.soapSend('ApplyItem', userPrefAml);
                if (res.getFaultCode() != 0) 
                {
                    aras.AlertError(res);
                    return;
                }
                var globalPref = res.getResult().selectSingleNode('./Item');
                var editorTheme = aras.getItemProperty(globalPref, 'monaco_editor_theme') || editorTheme;
                // [XAM]-E Restore theme

                var code = aras.getItemProperty(parent.parent.document.item, "method_code") || "";
                var editor = monaco.editor.create(document.getElementById('editormain'), {
                    value: code,
                    language: "javascript",
                    theme: editorTheme, // Default theme. Can be changed in the editor [XAM] Restore them
                    readOnly: !parent.parent.document.isEditMode
                });
                editor.getModel().updateOptions({ tabSize: 2, insertSpaces:false });
                parent.editor = editor;
                parent.monacoEditor = monaco.editor;
                parent.monaco = monaco;
                var codeLang = aras.getItemProperty(parent.parent.document.item, "method_type");
                parent.methodEditorHelper.setLanguage(codeLang);
                parent.methodEditorHelper.setTheme(editorTheme); // [XAM] Restore them
                parent.methodEditorHelper.setEditorChangeEvent();
                parent.methodEditorHelper.addEditorContextActions();
            });
        }
    </script>
</head>
<body>
    <div id="editormain" style="height:100%; width:100%; overflow: hidden;"></div>
</body>
</html>